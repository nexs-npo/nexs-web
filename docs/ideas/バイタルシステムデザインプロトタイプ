<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vitals with Live Log - nexs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'Space Mono', monospace; }

    /* HPバーのベース */
    .hp-container {
      position: relative;
      overflow: hidden;
    }
    
    .hp-fill {
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* エネルギー注入エフェクト（キラキラ） */
    @keyframes particle-burst {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(20); opacity: 0; }
    }
    .energy-burst {
      position: absolute;
      top: 50%;
      right: 0;
      width: 10px;
      height: 10px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      transform: translate(50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.8);
      animation: particle-burst 0.6s ease-out forwards;
    }

    /* システム反応の発光（バー全体が一瞬光る） */
    @keyframes system-flash {
      0% { filter: brightness(1); }
      10% { filter: brightness(3) drop-shadow(0 0 10px rgba(74, 222, 128, 0.5)); }
      100% { filter: brightness(1); }
    }
    .system-active {
      animation: system-flash 0.4s ease-out;
    }

    /* ログの出現アニメーション */
    @keyframes slide-down {
      0% { opacity: 0; transform: translateY(-10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .log-item {
      animation: slide-down 0.3s ease-out forwards;
    }
  </style>
</head>
<body class="bg-white text-gray-900 h-screen flex flex-col relative overflow-hidden">

  <!-- ============================================
       Header
       ============================================ -->
  <header class="bg-white border-b border-gray-100 sticky top-0 z-50">
    <div class="max-w-md mx-auto p-4">
      
      <!-- Top Row: Logo & Vitals -->
      <div class="flex justify-between items-center h-10 mb-2">
        <div class="font-bold text-xl tracking-tighter">nexs</div>
        
        <div class="flex items-center">
          <div class="flex flex-col items-end gap-1">
            <div class="flex items-center gap-2 text-[10px] font-bold leading-none">
              <span class="text-gray-400">活動余力</span>
              <span id="vitals-status" class="text-green-600 font-bold">正常</span>
            </div>
            
            <!-- Vitals Bar Container -->
            <div class="w-32 h-2 bg-gray-100 rounded-full overflow-hidden relative border border-gray-200 hp-container">
              <!-- Grid Lines -->
              <div class="absolute inset-0 flex justify-between px-1 pointer-events-none z-10 opacity-30">
                 <div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div>
              </div>
              
              <!-- HP Fill -->
              <div id="hp-bar" class="hp-fill w-[70%] h-full bg-green-500 rounded-full relative z-0">
                <!-- Burst Anchor (ここにエフェクトが出る) -->
                <div id="burst-anchor" class="absolute right-0 top-1/2 transform -translate-y-1/2"></div>
              </div>
            </div>
          </div>

          <!-- Support Button -->
          <button onclick="openDonateModal()" class="ml-3 flex items-center gap-1.5 bg-gray-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-gray-800 transition-colors shadow-md">
            支援
          </button>
        </div>
      </div>

      <!-- Bottom Row: Live Log (ログ表示エリア) -->
      <div class="h-6 overflow-hidden border-t border-gray-50 pt-1">
        <div id="log-container" class="flex flex-col text-[9px] font-mono text-gray-400 leading-tight">
          <div class="log-item flex items-center gap-1.5">
             <span class="w-1 h-1 rounded-full bg-gray-300"></span>
             <span>System Ready. Monitoring transactions...</span>
          </div>
        </div>
      </div>

    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 p-6 max-w-md mx-auto w-full">
    <h1 class="text-2xl font-bold mb-4 text-gray-900">Project Alpha (Scale-up)</h1>
    <p class="text-sm text-gray-600 mb-6 leading-loose text-justify">
      組織規模が拡大したフェーズのシミュレーションです。<br>
      現在、活動余力は十分（70%）にあります。<br>
      この状態では、少額の寄付（1,000円）を行っても、バーの長さは目に見えて変化しません。<br><br>
      しかし、右上のバーと、その下のログを見てください。<br>
      あなたの支援に対して、システムは確実に「反応」し、その事実を刻みます。
    </p>
  </main>

  <!-- ============================================
       Donation Modal
       ============================================ -->
  <div id="donate-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden flex items-end sm:items-center justify-center p-4">
    <div class="bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden">
      <div class="p-5">
        <h3 class="text-lg font-bold text-gray-900 mb-1">活動余力をチャージ</h3>
        <p class="text-xs text-gray-500 mb-6">大規模組織モード：少額寄付による微細な変動テスト</p>
        
        <div class="grid grid-cols-2 gap-3 mb-6">
          <button onclick="processDonation('small')" class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50 hover:border-gray-900 transition-all text-left group">
            <span class="block text-xs text-gray-400 mb-1">Supporter</span>
            <span class="block font-mono font-bold text-lg">¥1,000</span>
            <span class="text-[10px] text-gray-400 group-hover:text-green-600 transition-colors">+0.01% (微増)</span>
          </button>
          
          <button onclick="processDonation('large')" class="border-2 border-gray-900 bg-gray-900 text-white rounded-lg p-3 hover:bg-gray-800 transition-all text-left relative overflow-hidden">
            <span class="block text-xs text-gray-300 mb-1">Patron</span>
            <span class="block font-mono font-bold text-lg">¥100,000</span>
            <span class="text-[10px] text-yellow-300 font-bold">+10.0% (大幅)</span>
          </button>
        </div>
        
        <button onclick="closeDonateModal()" class="w-full py-3 text-xs font-bold text-gray-400 hover:text-gray-600">キャンセル</button>
      </div>
    </div>
  </div>

  <script>
    let currentHp = 70; // Start at 70%

    function openDonateModal() {
      document.getElementById('donate-modal').classList.remove('hidden');
    }

    function closeDonateModal() {
      document.getElementById('donate-modal').classList.add('hidden');
    }

    function processDonation(type) {
      closeDonateModal();

      setTimeout(() => {
        if (type === 'small') {
          // 1000円: ほぼ増えないが、エフェクトは出す
          addLog("Anonymous donated ¥1,000", "text-gray-900");
          triggerEffect(0.5); // 0.5%だけ増やす
        } else {
          // 10万円: 目に見えて増える
          addLog("PATRON donated ¥100,000!", "text-green-600 font-bold");
          triggerEffect(10); // 10%増やす
        }
      }, 300);
    }

    function triggerEffect(amount) {
      const hpBar = document.getElementById('hp-bar');
      const anchor = document.getElementById('burst-anchor');

      // 1. HP Update (上限100)
      currentHp = Math.min(currentHp + amount, 100);
      hpBar.style.width = currentHp + '%';
      
      // 2. System Flash (バー全体が白く光る)
      hpBar.classList.remove('system-active'); // リセット用
      void hpBar.offsetWidth; // Reflowハック
      hpBar.classList.add('system-active');

      // 3. Particle Burst (先端で弾ける)
      const burst = document.createElement('div');
      burst.className = 'energy-burst';
      anchor.appendChild(burst);
      
      // Clean up particle
      setTimeout(() => {
        burst.remove();
      }, 1000);
    }

    function addLog(msg, colorClass) {
      const container = document.getElementById('log-container');
      const now = new Date();
      const time = now.getHours() + ":" + String(now.getMinutes()).padStart(2, '0');
      
      const item = document.createElement('div');
      item.className = 'log-item flex items-center gap-1.5';
      item.innerHTML = `
        <span class="w-1 h-1 rounded-full bg-green-500 animate-pulse"></span>
        <span class="text-gray-400">[${time}]</span>
        <span class="${colorClass}">${msg}</span>
      `;
      
      // 新しいログを上に
      container.insertBefore(item, container.firstChild);
      
      // 古いログを消す（常に1行だけ見せる演出なら、2個目以降を消すかopacity下げる）
      if (container.children.length > 1) {
        // container.lastChild.remove(); // 完全に消す場合
      }
    }
  </script>
</body>
</html>
