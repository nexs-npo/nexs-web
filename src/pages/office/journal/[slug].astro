---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import PageWrapper from '@/components/PageWrapper';
import BaseLayout from '@/layouts/BaseLayout.astro';

export const getStaticPaths = (async () => {
  const journalEntries = await getCollection('journal');
  return journalEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content } = await entry.render();
const { data } = entry;

const authorInitials: Record<string, string> = {
  'nexs Research': 'N',
  'K. Suzuki': 'S',
};
const initial =
  authorInitials[data.author] || data.author.charAt(0).toUpperCase();
---

<BaseLayout title={`${data.title} - Journal - nexs`}>
  <PageWrapper
    activeTab="office"
    headerTitle="活動日誌"
    headerSubtitle={data.date}
    headerIconType="office"
    client:load
  >
    <div class="px-5 lg:px-8 max-w-md lg:max-w-[940px] mx-auto w-full animate-fade-in-up">
      <!-- Back Link -->
      <a
        href="/office/journal"
        class="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-gray-900 transition-colors mb-6"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
        <span>活動日誌一覧へ戻る</span>
      </a>

      <!-- Article Header -->
      <article class="bg-white rounded-xl border border-gray-100 shadow-sm p-6 mb-6">
        <h1 class="text-xl font-bold text-gray-900 mb-4 leading-tight">{data.title}</h1>

        <!-- Meta Info -->
        <div class="flex items-center justify-between pb-4 mb-6 border-b border-gray-100">
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] text-gray-500 font-bold">{initial}</div>
            <span class="text-sm text-gray-600">{data.author}</span>
          </div>
          <span class="text-sm text-gray-400 font-mono">{data.date}</span>
        </div>

        <!-- Summary -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <p class="text-sm text-gray-700 leading-relaxed">{data.summary}</p>
        </div>

        <!-- Content -->
        <div class="prose prose-sm lg:prose-base prose-gray max-w-none">
          <Content />
        </div>
      </article>
    </div>
  </PageWrapper>
</BaseLayout>

<style>
  /* MDX Content Styling */
  .prose {
    @apply text-gray-800;
  }
  .prose h2 {
    @apply text-lg font-bold text-gray-900 mt-6 mb-3;
  }
  .prose h3 {
    @apply text-base font-bold text-gray-900 mt-5 mb-2;
  }
  .prose p {
    @apply text-sm leading-relaxed mb-4;
  }
  .prose ul, .prose ol {
    @apply text-sm leading-relaxed mb-4 pl-5;
  }
  .prose li {
    @apply mb-1;
  }
  .prose a {
    @apply text-gray-900 underline hover:text-gray-600 transition-colors;
  }
  .prose code {
    @apply bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono;
  }
  .prose pre {
    @apply bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-xs;
  }
  .prose blockquote {
    @apply border-l-4 border-gray-300 pl-4 italic text-gray-600;
  }
</style>
