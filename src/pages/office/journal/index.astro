---
import { getCollection } from 'astro:content';
import PageWrapper from '@/components/PageWrapper';
import BaseLayout from '@/layouts/BaseLayout.astro';

const allJournal = await getCollection('journal');

// Sort by date (newest first)
const sortedJournal = allJournal.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

const authorInitials: Record<string, string> = {
  'nexs Research': 'N',
  'K. Suzuki': 'S',
};
---

<BaseLayout title="Journal - nexs">
  <PageWrapper
    activeTab="office"
    headerTitle="Journal"
    headerSubtitle="理事長の活動日誌"
    headerIconType="office"
    client:load
  >
    <div class="px-5 max-w-md mx-auto w-full animate-fade-in-up">
      {sortedJournal.length === 0 ? (
        <div class="flex flex-col items-center justify-center pt-16 text-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300 mb-6">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          <h2 class="text-lg font-bold text-gray-900 mb-2">まだ記事がありません</h2>
          <p class="text-sm text-gray-500 leading-relaxed">
            活動日誌は準備中です。
          </p>
        </div>
      ) : (
        <section class="space-y-3">
          {sortedJournal.map((entry) => {
            const { data, slug } = entry;
            const initial = authorInitials[data.author] || data.author.charAt(0).toUpperCase();

            return (
              <a
                href={`/office/journal/${slug}/`}
                class="block bg-white rounded-xl border border-gray-100 p-5 shadow-sm hover:shadow-md hover:border-gray-200 transition-all cursor-pointer"
              >
                <h3 class="text-base font-bold text-gray-900 mb-2">{data.title}</h3>
                <p class="text-sm text-gray-600 leading-normal line-clamp-3 mb-3">
                  {data.summary}
                </p>
                <div class="flex items-center justify-between pt-3 border-t border-gray-50">
                  <div class="flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center text-[9px] text-gray-500 font-bold">{initial}</div>
                    <span class="text-xs text-gray-500">{data.author}</span>
                  </div>
                  <span class="text-xs text-gray-400 font-mono">{data.date}</span>
                </div>
              </a>
            );
          })}
        </section>
      )}
    </div>
  </PageWrapper>
</BaseLayout>
