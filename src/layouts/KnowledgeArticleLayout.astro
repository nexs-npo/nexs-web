---
import CopyForAI from '@/components/knowledge/CopyForAI';
import KnowledgeLinkTooltip from '@/components/knowledge/KnowledgeLinkTooltip.astro';
import PageWrapper from '@/components/PageWrapper';
import BaseLayout from '@/layouts/BaseLayout.astro';

interface Props {
  id: string;
  title: string;
  summary: string;
  category: 'foundation' | 'thesis' | 'protocol' | 'evidence' | 'update';
  author: string;
  date: string;
  contentText: string;
}

const { id, title, summary, category, author, date, contentText } = Astro.props;

const categoryLabels: Record<string, string> = {
  foundation: 'FOUNDATION',
  thesis: 'THESIS',
  protocol: 'PROTOCOL',
  evidence: 'EVIDENCE',
  update: 'UPDATE',
};

const categoryColors: Record<string, string> = {
  foundation: 'bg-blue-600',
  thesis: 'bg-green-600',
  protocol: 'bg-purple-600',
  evidence: 'bg-orange-600',
  update: 'bg-red-600',
};

// Structured Data (JSON-LD) for the article
const articleJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ScholarlyArticle',
  headline: title,
  description: summary,
  identifier: id,
  author: {
    '@type': 'Person',
    name: author,
  },
  datePublished: date,
  genre: categoryLabels[category],
  publisher: {
    '@type': 'Organization',
    name: '次世代社会デザイン研究機構',
    url: 'https://nexs.or.jp',
  },
};
---

<BaseLayout title={`${title} - Library`} description={summary}>
  <!-- Structured Data for Article -->
  <script type="application/ld+json" set:html={JSON.stringify(articleJsonLd)} slot="head" />

  <PageWrapper
    activeTab="library"
    headerTitle="Library"
    headerSubtitle="仮説から社会の更新まで。リンク可能な知識コンポーネント"
    headerIconType="library"
    client:load
  >
    <div class="px-5 max-w-md mx-auto w-full animate-fade-in-up">
      <!-- Article Header -->
      <section class="mb-8">
        <div class="mb-3">
          <span class={`text-[9px] font-bold uppercase tracking-widest text-white ${categoryColors[category]} px-2 py-1 rounded`}>
            {categoryLabels[category]}
          </span>
          <span class="text-xs font-mono text-gray-400 ml-2">#{id}</span>
        </div>
        <h1 class="text-2xl font-bold text-gray-900 mb-3">{title}</h1>
        <p class="text-sm text-gray-600 leading-relaxed">{summary}</p>
        <div class="flex items-center gap-2 text-xs text-gray-500 mt-3">
          <span>{date}</span>
          <span>&bull;</span>
          <span>{author}</span>
        </div>
      </section>

      <!-- Content -->
      <section class="mb-8 prose prose-sm max-w-none knowledge-content">
        <slot />
      </section>

      <!-- Actions -->
      <div class="flex gap-3 mb-8">
        <a
          href="/library/"
          class="flex-1 flex items-center justify-center gap-2 rounded-xl border border-gray-200 bg-white py-3 text-xs font-bold text-gray-800 hover:bg-gray-50 transition-colors"
        >
          &larr; Back to Library
        </a>
        <CopyForAI
          articleId={id}
          articleTitle={title}
          articleSummary={summary}
          articleContent={contentText}
          client:load
        />
      </div>
    </div>
  </PageWrapper>

  <KnowledgeLinkTooltip />
</BaseLayout>

<!--
  Knowledge記事のスタイルは src/styles/global.css に統合されています。
  変更したい場合はそちらを編集してください。
-->
